# ============================================================================
# Node B Configuration - Mesh Entry Point Node
# ============================================================================
# This node:
#   - Receives external HTTP requests
#   - Forwards requests via mesh egress to Node A
#   - Acts as the "entry point" in the mesh topology
# ============================================================================

[proxy]
name = "harmony-node-b"
pipelines_path = "pipelines"
primary_provider = "local"

# Provider Configuration
[provider.runbeam]
api = "https://api.runbeam.cloud"
poll_interval_secs = 30

# ============================================================================
# Management API
# ============================================================================
[management]
enabled = true
base_path = "admin"
network = "management"

# ============================================================================
# Networks
# ============================================================================
[network.default]
enable_wireguard = false
interface = "wg0"

[network.default.http]
bind_address = "0.0.0.0"
bind_port = 8080

[network.management]
enable_wireguard = false
interface = "wg0"

[network.management.http]
bind_address = "0.0.0.0"
bind_port = 9090

# ============================================================================
# Logging
# ============================================================================
[logging]
log_level = "debug"
log_to_file = true
log_file_path = "/tmp/harmony/harmony.log"

# ============================================================================
# Storage
# ============================================================================
[storage]
backend = "filesystem"

[storage.options]
path = "/tmp/harmony"

# ============================================================================
# Service Types
# ============================================================================
[services.http]
module = ""

[services.echo]
module = ""

# ============================================================================
# Middleware Types
# ============================================================================
[middleware_types.passthru]
module = ""

[middleware_types.mesh_auth]
module = ""

# ============================================================================
# Mesh Configuration - EGRESS SIDE
# ============================================================================
# Node B defines mesh authentication for outgoing requests
# Remote ingress defines the URLs of mesh members we can route to
# Egress points are defined in the pipeline under pipelines.{name}.mesh.egress
# ============================================================================

[mesh.test_mesh]
type = "http"
provider = "local"
auth_type = "jwt"
# Shared secret for mesh JWT authentication (same on both nodes)
jwt_secret = "mesh-test-secret-key-change-in-production"
# Reference both remote ingress (for egress URL matching) and local egress
ingress = ["node_a_api"]  # Remote ingress name for URL matching
egress = ["node_a_egress"]
description = "Test mesh for Docker networking demo"
enabled = true

# ============================================================================
# Remote Ingress - URLs of remote mesh members
# ============================================================================

[remote_ingress.node_a_api]
urls = ["http://node-a.mesh.local:8080"]
